- name: Create /etc/kubernetes/pki dir
  file:
    path: /etc/kubernetes/pki
    state: directory

- name: Copy CA configs
  template:
    src: "{{ item }}.j2"
    dest: "/etc/kubernetes/pki/{{ item }}"
  loop:
    - ca-config.json
    - ca-csr.json

- name: Generate CA cert and key
  shell:
    cmd: cfssl gencert -initca ca-csr.json | cfssljson -bare ca
    chdir: /etc/kubernetes/pki
    creates: /etc/kubernetes/pki/ca.pem